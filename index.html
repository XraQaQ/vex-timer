<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>VEX Timer</title>

<style>
:root{
  --bg:#0b0f14;
  --panel:#121824;
  --text:#e8eefc;
  --muted:#98a6c6;
  --vex-red:#e11919;
  --border:rgba(255,255,255,0.08);
  --radius:16px;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:#070a0f;
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  display:flex;
  justify-content:center;
  padding:24px;
}
.app{width:900px;max-width:100%}
.card{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:20px;
}
h1{margin:0 0 12px 0;font-size:18px}
#time{
  font-size:72px;
  font-weight:900;
  text-align:center;
  margin:20px 0;
}
.controls{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
.btn{
  padding:12px;
  font-size:14px;
  font-weight:800;
  border-radius:12px;
  border:1px solid var(--border);
  background:#151b2a;
  color:var(--text);
  cursor:pointer;
}
.btn.primary{background:var(--vex-red)}
.btn:disabled{opacity:.4}
.row{display:flex;gap:10px;margin-top:10px}
input{
  background:#0f1522;
  border:1px solid var(--border);
  border-radius:10px;
  color:var(--text);
  padding:10px;
  width:100%;
}
.small{font-size:12px;color:var(--muted)}
</style>
</head>

<body>
<div class="app">
  <div class="card">
    <h1>VEX TIMER</h1>

    <div id="time">0:00</div>

    <div class="controls">
      <button class="btn primary" onclick="modeSkills()">Skills</button>
      <button class="btn primary" onclick="modeDriver()">Driver</button>
      <button class="btn" onclick="modeAuto15()">15秒自动</button>
      <button class="btn" onclick="resetAll()">重置</button>
    </div>

    <div class="row">
      <input id="customInput" type="number" min="1" placeholder="自定义秒数（如 120）">
      <button class="btn primary" onclick="modeCustom()">Custom Start</button>
    </div>

    <div class="row">
      <button class="btn" id="pauseBtn" onclick="pauseTimer()" disabled>暂停</button>
      <button class="btn" id="resumeBtn" onclick="resumeTimer()" disabled>继续</button>
    </div>

    <p class="small">
      自定义规则：30秒前每10秒报时，30–15每5秒，15秒倒数
    </p>
  </div>
</div>

<script>
let timer=null, remaining=0, paused=false, resumeHandler=null;

function speak(t){
  const u=new SpeechSynthesisUtterance(t);
  u.lang="zh-CN";
  speechSynthesis.speak(u);
}
function update(){
  const m=Math.floor(remaining/60), s=remaining%60;
  document.getElementById("time").innerText=`${m}:${s.toString().padStart(2,"0")}`;
}
function clearT(){ if(timer){clearInterval(timer);timer=null;} }

function setPause(p){
  document.getElementById("pauseBtn").disabled=!p;
  document.getElementById("resumeBtn").disabled=p;
}

function resetAll(){
  clearT();
  paused=false;
  remaining=0;
  update();
  setPause(false);
  try{speechSynthesis.cancel()}catch{}
}

function pauseTimer(){
  if(!timer)return;
  clearT();
  paused=true;
  setPause(false);
}
function resumeTimer(){
  if(!paused)return;
  paused=false;
  timer=setInterval(resumeHandler,1000);
  setPause(true);
}

function start321(startSeconds,onTick){
  resetAll();
  remaining=3;
  update();
  speak("3");

  resumeHandler=function(){
    remaining--;
    update();
    if(remaining===2)speak("2");
    if(remaining===1)speak("1");
    if(remaining<=0){
      clearT();
      remaining=startSeconds;
      update();
      speak(startSeconds+"秒");
      resumeHandler=onTick;
      timer=setInterval(resumeHandler,1000);
      setPause(true);
    }
  };
  timer=setInterval(resumeHandler,1000);
  setPause(true);
}

/* ===== 预设模式 ===== */
function modeSkills(){
  start321(60,()=>{
    remaining--;update();
    if([50,40,30,25].includes(remaining))speak(remaining+"秒");
    if(remaining<=20&&remaining>0)speak(""+remaining);
    if(remaining<=0){clearT();speak("结束");setPause(false);}
  });
}
function modeDriver(){
  start321(105,()=>{
    remaining--;update();
    if([90,70,60,50,40,30,25,20].includes(remaining))speak(remaining+"秒");
    if(remaining<=15&&remaining>0)speak(""+remaining);
    if(remaining<=0){clearT();speak("结束");setPause(false);}
  });
}
function modeAuto15(){
  start321(15,()=>{
    remaining--;update();
    if(remaining<=0){clearT();setPause(false);}
  });
}

/* ===== 自定义模式 ===== */
function modeCustom(){
  const val=parseInt(document.getElementById("customInput").value);
  if(!val||val<=0)return alert("请输入有效秒数");
  start321(val,()=>{
    remaining--;update();

    if(remaining>30 && remaining%10===0){
      speak(remaining+"秒");
    }
    if(remaining<=30 && remaining>15 && remaining%5===0){
      speak(remaining+"秒");
    }
    if(remaining<=15 && remaining>0){
      speak(""+remaining);
    }
    if(remaining<=0){
      clearT();
      speak("结束");
      setPause(false);
    }
  });
}
</script>
</body>
</html>
